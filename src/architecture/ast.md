
## 抽象構文木 (AST)
### 入力
- 各ノードは任意個の入力を持つ
	- 入力に取れるのは以下のいずれか
		- 即値
		- 他プラグインの主出力
			- 自分のみが取得できる
		- 他プラグインの副出力
			- 任意個の入力で共有できる

### 出力
- 各ノードは1個以上の出力を持つ
	- 最初の出力は「主出力」であり，UI上でも親子関係を構築する
	- 2番目以降の出力は「副出力」であり，任意の場所から参照できる
		- ただし，循環を作ることは許可されない

### 木構造
- Effect のプラグインをノードとし，主出力の入力を親子関係とする木を構築する
	- 値の上書き等で主出力を上書きした際には，ASTノードごと消滅する （副出力も消える）

## 代入
- 代入によりASTノードが消滅することがある
	- サブツリーとメインツリーに分け，間に存在する副出力の参照を全て切断する処理をしている
- Undo と Redo では，再び繋ぎなおす必要がある （2025/04/08 時点で未実装）

## マクロ
- Macro のプラグインは AST を生成できる （2025/04/08 時点で未実装）
	- 実体を生み出すわけではなく，レンダリング時のみ生成される仮のサブツリーを生成する
	- 実体化した上で，手動で編集することもできる

## スケジューリング
### トポロジカルソート
- 主出力と副出力両方の参照関係を用いて，トポロジカルソートを行う。
	- トポロジカルソートに失敗した場合にはスケジューリング不能としてレンダリングに失敗する
	- 1フレームずつ，順に呼び出すことで各フレームを生成する

### 非因果的システム
- 例えば逆再生などは代表的な非因果的システム
	- 入力パラメータ全体について，未来の値を取れる必要がある
	- トポロジカルソート結果を，非因果的システムを根とするノード群に切り分ける
		- それらを1フレームずつ，順に呼び出して各フレームを生成する
		- 後続の処理で使う変数のみ，全フレーム分を保持する


